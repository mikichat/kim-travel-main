<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²¬ì ì„œ êµ¬ì¡° ë¶„ì„ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #4ec9b0;
            margin-bottom: 20px;
        }

        .upload-box {
            background: #252526;
            border: 2px dashed #4ec9b0;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
        }

        .upload-box:hover {
            background: #2d2d30;
        }

        .data-grid {
            background: #252526;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th, td {
            padding: 8px;
            border: 1px solid #3e3e42;
            text-align: left;
            white-space: nowrap;
        }

        th {
            background: #2d2d30;
            color: #4ec9b0;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #2d2d30;
        }

        .row-number {
            color: #858585;
            font-weight: bold;
        }

        .cell-value {
            color: #ce9178;
        }

        .cell-empty {
            color: #858585;
            font-style: italic;
        }

        .analysis-section {
            background: #252526;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .analysis-section h2 {
            color: #569cd6;
            margin-bottom: 15px;
        }

        .keyword {
            display: inline-block;
            background: #264f78;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 5px;
            color: #9cdcfe;
        }

        .btn {
            background: #0e639c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn:hover {
            background: #1177bb;
        }

        .btn-success {
            background: #14ce14;
        }

        .btn-success:hover {
            background: #16b116;
        }

        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #3e3e42;
            overflow-x: auto;
            color: #d4d4d4;
        }

        .found-item {
            margin: 10px 0;
            padding: 10px;
            background: #1e1e1e;
            border-left: 3px solid #4ec9b0;
            border-radius: 3px;
        }

        .found-item strong {
            color: #4ec9b0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ê²¬ì ì„œ êµ¬ì¡° ë¶„ì„ê¸°</h1>
        <p style="color: #858585; margin-bottom: 20px;">ê²¬ì ì„œ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë°ì´í„° êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ê³ , í•˜ë‚˜íˆ¬ì–´ í…œí”Œë¦¿ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆëŠ” ë§¤í•‘ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>

        <div class="upload-box" id="uploadBox">
            <h2>ğŸ“ ê²¬ì ì„œ íŒŒì¼ ì—…ë¡œë“œ</h2>
            <p style="color: #858585; margin-top: 10px;">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
        </div>

        <div id="resultsSection" style="display: none;">
            <div class="analysis-section">
                <h2>ğŸ“Š íŒŒì¼ ì •ë³´</h2>
                <div id="fileInfo"></div>
            </div>

            <div class="analysis-section">
                <h2>ğŸ” ë°œê²¬ëœ í‚¤ì›Œë“œ</h2>
                <div id="keywordResults"></div>
            </div>

            <div class="analysis-section">
                <h2>ğŸ¯ ì¶”ì²œ ë§¤í•‘</h2>
                <div id="mappingResults"></div>
            </div>

            <div class="data-grid">
                <h2 style="color: #569cd6; margin-bottom: 15px;">ğŸ“‹ ì „ì²´ ë°ì´í„° (ì²˜ìŒ 50í–‰)</h2>
                <div id="dataGrid"></div>
            </div>

            <button class="btn btn-success" id="exportMappingBtn">
                ğŸ’¾ ë³€í™˜ ì½”ë“œ ë‚´ë³´ë‚´ê¸°
            </button>
            <button class="btn" id="resetBtn">
                ğŸ”„ ë‹¤ì‹œ ì‹œì‘
            </button>
        </div>
    </div>

    <script>
        let excelData = null;
        let mappingInfo = {};

        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');

        uploadBox.addEventListener('click', () => fileInput.click());
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.style.background = '#2d2d30';
        });
        uploadBox.addEventListener('dragleave', () => {
            uploadBox.style.background = '#252526';
        });
        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.style.background = '#252526';
            const file = e.dataTransfer.files[0];
            if (file) processFile(file);
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) processFile(file);
        });

        function processFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1, defval: '' });

                    excelData = jsonData;
                    analyzeData(jsonData, file.name, workbook.SheetNames);

                } catch (error) {
                    alert('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function analyzeData(data, fileName, sheetNames) {
            // íŒŒì¼ ì •ë³´
            document.getElementById('fileInfo').innerHTML = `
                <div class="found-item">
                    <strong>íŒŒì¼ëª…:</strong> ${fileName}<br>
                    <strong>ì‹œíŠ¸:</strong> ${sheetNames.join(', ')}<br>
                    <strong>ì´ í–‰ ìˆ˜:</strong> ${data.length}<br>
                    <strong>ì´ ì—´ ìˆ˜:</strong> ${Math.max(...data.map(row => row.length))}
                </div>
            `;

            // í‚¤ì›Œë“œ ê²€ìƒ‰
            const keywords = {
                'ìƒí’ˆì •ë³´': ['ìƒí’ˆëª…', 'ìƒí’ˆì½”ë“œ', 'íŒ¨í‚¤ì§€', 'ì—¬í–‰', 'íˆ¬ì–´'],
                'ëª©ì ì§€': ['ëª©ì ì§€', 'ì§€ì—­', 'êµ­ê°€', 'ë„ì‹œ', 'ë‹¤ë‚­', 'ë°©ì½•', 'íŒŒíƒ€ì•¼'],
                'ê¸°ê°„': ['ë°•', 'ì¼', 'ê¸°ê°„', 'ì¼ì •'],
                'ê°€ê²©': ['ì„±ì¸', 'ì•„ë™', 'ìœ ì•„', 'ê¸ˆì•¡', 'ê°€ê²©', 'ìš”ê¸ˆ', 'ì›'],
                'í•­ê³µ': ['í•­ê³µ', 'ë¹„í–‰ê¸°', 'ì¶œë°œ', 'ë„ì°©', 'ì¸ì²œ', 'ê¹€í¬'],
                'í˜¸í…”': ['í˜¸í…”', 'ìˆ™ì†Œ', 'ë¦¬ì¡°íŠ¸', 'í˜¸í…”ëª…'],
                'ì¼ì •': ['ì¼ì°¨', 'DAY', 'Day', 'ì¼ì •', 'ìŠ¤ì¼€ì¤„'],
                'í¬í•¨ì‚¬í•­': ['í¬í•¨', 'í¬í•¨ì‚¬í•­', 'í¬í•¨ë‚´ì—­'],
                'ë¶ˆí¬í•¨ì‚¬í•­': ['ë¶ˆí¬í•¨', 'ë¶ˆí¬í•¨ì‚¬í•­', 'ì œì™¸'],
                'ì„ íƒê´€ê´‘': ['ì„ íƒ', 'ì˜µì…˜', 'ì¶”ê°€'],
                'ìœ ë¥˜í• ì¦ë£Œ': ['ìœ ë¥˜', 'ìœ ë¥˜í• ì¦'],
                'ì œì„¸ê³µê³¼ê¸ˆ': ['ì œì„¸', 'ê³µê³¼'],
                'ì‹±ê¸€ì°¨ì§€': ['ì‹±ê¸€', '1ì¸', 'ì¶”ê°€']
            };

            let foundKeywords = {};
            let keywordHTML = '';

            for (let [category, words] of Object.entries(keywords)) {
                foundKeywords[category] = [];

                for (let rowIdx = 0; rowIdx < data.length; rowIdx++) {
                    for (let colIdx = 0; colIdx < data[rowIdx].length; colIdx++) {
                        const cell = String(data[rowIdx][colIdx]).trim();

                        for (let word of words) {
                            if (cell.includes(word)) {
                                foundKeywords[category].push({
                                    row: rowIdx + 1,
                                    col: colIdx + 1,
                                    value: cell,
                                    nextCell: data[rowIdx][colIdx + 1] || '',
                                    nextRow: data[rowIdx + 1] ? data[rowIdx + 1][colIdx] : ''
                                });
                            }
                        }
                    }
                }

                if (foundKeywords[category].length > 0) {
                    keywordHTML += `<div class="found-item">
                        <strong>${category}:</strong><br>`;

                    foundKeywords[category].slice(0, 5).forEach(found => {
                        keywordHTML += `
                            <span class="keyword">í–‰${found.row}, ì—´${found.col}: "${found.value}"
                            ${found.nextCell ? ` â†’ "${found.nextCell}"` : ''}
                            </span>`;
                    });

                    keywordHTML += `</div>`;
                }
            }

            document.getElementById('keywordResults').innerHTML = keywordHTML || '<p style="color: #858585;">í‚¤ì›Œë“œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';

            // ë§¤í•‘ ì¶”ì²œ
            let mappingHTML = '<pre>';
            mappingHTML += '// ë°œê²¬ëœ ë°ì´í„° ìœ„ì¹˜ ê¸°ë°˜ ì¶”ì²œ ë§¤í•‘\n\n';
            mappingHTML += 'const mapping = {\n';

            for (let [category, items] of Object.entries(foundKeywords)) {
                if (items.length > 0) {
                    const first = items[0];
                    mappingHTML += `  '${category}': { row: ${first.row}, col: ${first.col}, nextCell: "${first.nextCell}" },\n`;
                }
            }

            mappingHTML += '};\n';
            mappingHTML += '</pre>';

            document.getElementById('mappingResults').innerHTML = mappingHTML;

            // ë°ì´í„° ê·¸ë¦¬ë“œ
            let gridHTML = '<table><thead><tr><th>í–‰</th>';

            const maxCols = Math.max(...data.map(row => row.length));
            for (let i = 0; i < Math.min(maxCols, 20); i++) {
                gridHTML += `<th>${String.fromCharCode(65 + i)}</th>`;
            }

            gridHTML += '</tr></thead><tbody>';

            data.slice(0, 50).forEach((row, rowIdx) => {
                gridHTML += `<tr><td class="row-number">${rowIdx + 1}</td>`;

                for (let colIdx = 0; colIdx < Math.min(maxCols, 20); colIdx++) {
                    const cell = row[colIdx] || '';
                    const displayValue = String(cell).substring(0, 50);
                    const className = cell ? 'cell-value' : 'cell-empty';
                    gridHTML += `<td class="${className}">${displayValue || '(ë¹ˆ ì…€)'}</td>`;
                }

                gridHTML += '</tr>';
            });

            gridHTML += '</tbody></table>';

            document.getElementById('dataGrid').innerHTML = gridHTML;

            // Show results
            document.getElementById('resultsSection').style.display = 'block';
            mappingInfo = foundKeywords;
        }

        document.getElementById('exportMappingBtn').addEventListener('click', () => {
            const code = `
// ìë™ ìƒì„±ëœ ë³€í™˜ ì½”ë“œ
function convertQuoteToHanatour(data) {
    const result = {
        'ìƒí’ˆì½”ë“œ': extractFromPosition(data, ${JSON.stringify(mappingInfo['ìƒí’ˆì •ë³´']?.[0])}),
        'ìƒí’ˆëª…': extractFromPosition(data, ${JSON.stringify(mappingInfo['ìƒí’ˆì •ë³´']?.[0])}),
        'ëª©ì ì§€': extractFromPosition(data, ${JSON.stringify(mappingInfo['ëª©ì ì§€']?.[0])}),
        'ì—¬í–‰ê¸°ê°„': extractFromPosition(data, ${JSON.stringify(mappingInfo['ê¸°ê°„']?.[0])}),
        'ì„±ì¸ê°€ê²©': extractPrice(data, ${JSON.stringify(mappingInfo['ê°€ê²©']?.[0])}),
        'í˜¸í…”ëª…1': extractFromPosition(data, ${JSON.stringify(mappingInfo['í˜¸í…”']?.[0])}),
        'í¬í•¨ì‚¬í•­': extractFromPosition(data, ${JSON.stringify(mappingInfo['í¬í•¨ì‚¬í•­']?.[0])}),
        'ë¶ˆí¬í•¨ì‚¬í•­': extractFromPosition(data, ${JSON.stringify(mappingInfo['ë¶ˆí¬í•¨ì‚¬í•­']?.[0])})
    };
    return result;
}

function extractFromPosition(data, position) {
    if (!position) return '';
    return data[position.row - 1]?.[position.col] || position.nextCell || '';
}

function extractPrice(data, position) {
    if (!position) return 0;
    const value = String(position.nextCell || '').replace(/[^0-9]/g, '');
    return parseInt(value) || 0;
}
`;

            const blob = new Blob([code], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'conversion_mapping.js';
            a.click();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            document.getElementById('resultsSection').style.display = 'none';
            excelData = null;
            mappingInfo = {};
            fileInput.value = '';
        });
    </script>
</body>
</html>
