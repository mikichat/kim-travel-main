<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—¬í–‰ ì¼ì •í‘œ</title>
    <style>
        @media print {
            @page {
                size: A4;
                margin: 10mm;
            }
            .no-print {
                display: none !important;
            }
            body {
                background: white !important;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .no-print {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn {
            padding: 12px 30px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            font-family: 'Malgun Gothic', sans-serif;
            transition: all 0.3s;
        }

        .btn-print {
            background: #4CAF50;
            color: white;
        }

        .btn-print:hover {
            background: #45a049;
        }

        .btn-back {
            background: #666;
            color: white;
        }

        .btn-back:hover {
            background: #555;
        }

        .btn-save {
            background: #2196F3;
            color: white;
        }

        .btn-save:hover {
            background: #0b7dda;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto 20px;
            padding: 15mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            page-break-after: always;
        }

        .page:last-child {
            page-break-after: auto;
        }

        /* í—¤ë” */
        .header {
            border-bottom: 1px solid #999;
            padding-bottom: 3mm;
            margin-bottom: 5mm;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3mm;
        }

        .company-info {
            font-size: 9pt;
            color: #666;
        }

        .header h1 {
            text-align: center;
            font-size: 24pt;
            color: #333;
            margin: 5mm 0;
        }

        /* ê¸°ë³¸ ì •ë³´ í…Œì´ë¸” */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5mm;
            font-size: 10pt;
        }

        .info-table th {
            background: #f3ebe1;
            padding: 8px;
            border: 1px solid #bbb;
            text-align: center;
            font-weight: bold;
            width: 20%;
        }

        .info-table td {
            padding: 8px;
            border: 1px solid #bbb;
        }

        .info-table .price {
            color: #c00;
            font-weight: bold;
            font-size: 11pt;
            text-align: right;
        }

        /* ì—¬í–‰ ì¡°ê±´ */
        .section-title {
            background: #333;
            color: white;
            padding: 6px;
            text-align: center;
            font-size: 11pt;
            font-weight: bold;
            margin: 5mm 0 3mm 0;
        }

        .condition-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5mm;
            font-size: 9pt;
        }

        .condition-table th {
            background: #f3ebe1;
            padding: 6px;
            border: 1px solid #bbb;
            width: 18%;
            font-weight: bold;
        }

        .condition-table td {
            padding: 6px;
            border: 1px solid #bbb;
        }

        .condition-table td.note {
            font-size: 8.5pt;
            line-height: 1.4;
        }

        /* ì¼ì •í‘œ */
        .itinerary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 3mm;
            font-size: 9pt;
        }

        .itinerary-table th {
            background: #f3ebe1;
            padding: 5px;
            border: 1px solid #999;
            font-weight: bold;
            text-align: center;
        }

        .itinerary-table td {
            padding: 6px;
            border: 1px solid #999;
            vertical-align: top;
        }

        .itinerary-table .day-col {
            width: 8%;
            text-align: center;
            font-weight: bold;
            background: #f9f9f9;
        }

        .itinerary-table .date-col {
            width: 12%;
            text-align: center;
        }

        .itinerary-table .region-col {
            width: 15%;
        }

        .itinerary-table .transport-col {
            width: 15%;
            font-size: 8.5pt;
        }

        .itinerary-table .time-col {
            width: 10%;
            text-align: center;
            font-size: 8.5pt;
        }

        .itinerary-table .schedule-col {
            width: 25%;
            line-height: 1.4;
            white-space: pre-line;
        }

        .itinerary-table .meals-col {
            width: 8%;
            text-align: center;
        }

        .itinerary-table .hotel-col {
            width: 12%;
            font-size: 8.5pt;
        }

        /* Footer */
        .footer {
            margin-top: 8mm;
            padding-top: 3mm;
            border-top: 1px solid #999;
            text-align: center;
            font-size: 9pt;
        }

        .footer-text {
            margin-bottom: 8px;
        }

        .footer-company {
            font-size: 12pt;
            font-weight: bold;
            margin: 5mm 0;
        }

        .footer-address {
            font-size: 8pt;
            color: #666;
        }

        /* í¬í•¨/ë¶ˆí¬í•¨ ë°•ìŠ¤ */
        .include-box {
            border: 2px solid #333;
            padding: 5mm;
            margin: 3mm 0;
            font-size: 9pt;
        }

        .include-box h3 {
            font-size: 10pt;
            margin-bottom: 2mm;
            color: #333;
        }

        .include-box ul {
            margin-left: 5mm;
            line-height: 1.6;
        }

        .include-box .col-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5mm;
        }

        /* ì£¼ì˜ì‚¬í•­ ë°•ìŠ¤ */
        .notice-box {
            background: #fffbf0;
            border: 2px solid #ffa500;
            padding: 5mm;
            margin: 3mm 0;
            font-size: 9pt;
            line-height: 1.6;
        }

        .notice-box h3 {
            color: #ff6600;
            margin-bottom: 2mm;
            font-size: 10pt;
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
        <button class="btn btn-save" onclick="saveAsHTML()">ğŸ’¾ HTML ì €ì¥</button>
        <button class="btn btn-back" onclick="window.close()">â† ëŒì•„ê°€ê¸°</button>
    </div>

    <div class="page" id="printContent">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="header-top">
                <div style="flex: 1;"></div>
                <div class="company-info">
                    ë‹´ë‹¹ì: <span id="manager">ê¹€êµ­ì§„</span> <span id="contact">010-2662-9009</span>
                </div>
            </div>
            <h1>ì—¬ í–‰ ì¼ ì • í‘œ</h1>
        </div>

        <!-- ê¸°ë³¸ ì •ë³´ -->
        <table class="info-table">
            <tr>
                <th>ë‹¨ì²´ëª…</th>
                <td colspan="3" id="packageName"></td>
            </tr>
            <tr>
                <th>ì¼ì</th>
                <td colspan="3" id="travelDates"></td>
            </tr>
            <tr>
                <th>ì—¬í–‰ì§€</th>
                <td colspan="3" id="destination"></td>
            </tr>
            <tr>
                <th>1ì¸ ì—¬í–‰ìš”ê¸ˆ</th>
                <td id="airline"></td>
                <td id="flightInfo"></td>
                <td class="price" id="price"></td>
            </tr>
        </table>

        <!-- ì—¬í–‰ ì¡°ê±´ -->
        <div class="section-title">â™ ì—¬ í–‰ ì¡° ê±´ â™</div>
        <table class="condition-table">
            <tr>
                <th>í•­ê³µë£Œ</th>
                <td colspan="2">ì „ ì¼ì •ì— ëª…ì‹œëœ í•­ê³µë£Œ</td>
            </tr>
            <tr>
                <th>ìˆ™ë°•</th>
                <td colspan="2">ì¼ì •ì— ìˆëŠ” ìˆ™ë°• í¬í•¨ (2ì¸ 1ì‹¤ ê¸°ì¤€)</td>
            </tr>
            <tr>
                <th>ì‹ì‚¬</th>
                <td colspan="2">ì¼ì •ì— ìˆëŠ” ì‹ì‚¬ í¬í•¨</td>
            </tr>
            <tr>
                <th>êµí†µí¸</th>
                <td colspan="2">ì¼ì •ì— ë”°ë¥¸ ì°¨ëŸ‰ ì´ìš© êµí†µ í¬í•¨</td>
            </tr>
            <tr>
                <th>ê´€ê´‘</th>
                <td colspan="2">ì „ ì¼ì •ì— ëª…ì‹œëœ ê´€ê´‘ ë¹„ìš© í¬í•¨</td>
            </tr>
            <tr>
                <th>ì—¬í–‰ì ë³´í—˜</th>
                <td colspan="2">ì—¬í–‰ ê¸°ê°„ í•´ì™¸ ì—¬í–‰ì ë³´í—˜ ê°€ì…</td>
            </tr>
            <tr>
                <th>ê¸°íƒ€ ì„¸ê¸ˆ</th>
                <td colspan="2">ê³µí•­ ì´ìš©ë£Œ, ì¶œêµ­ì„¸, ì…êµ­ì„¸ í¬í•¨</td>
            </tr>
            <tr>
                <th>ë¹„ê³  ì‚¬í•­</th>
                <td colspan="2" class="note" id="notes">
                    â—‹ ìƒê¸° ì¼ì •ì€ ê¸°ìƒì•…í™”ë‚˜ í˜„ì§€ ì‚¬ì •ìœ¼ë¡œ ì¸í•˜ì—¬ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                    â—‹ í˜„ê¸ˆ ê²°ì œ ì¡°ê±´ì…ë‹ˆë‹¤.<br>
                    â—‹ ì‹ì‚¬ ì‹œ ìŒë£Œ(ì£¼ë¥˜) ë° ì‹ì‚¬ ì¶”ê°€ëŠ” ë¶ˆí¬í•¨
                </td>
            </tr>
        </table>

        <!-- ì¼ì •í‘œ -->
        <div class="section-title">â™ ì—¬ í–‰ ì¼ ì • â™</div>
        <table class="itinerary-table">
            <thead>
                <tr>
                    <th class="day-col">ì¼ì°¨</th>
                    <th class="date-col">ì¼ì</th>
                    <th class="region-col">ì§€ì—­</th>
                    <th class="transport-col">êµí†µí¸</th>
                    <th class="time-col">ì‹œê°„</th>
                    <th class="schedule-col">ì¼ì •</th>
                    <th class="meals-col">ì‹ì‚¬</th>
                    <th class="hotel-col">ìˆ™ë°•</th>
                </tr>
            </thead>
            <tbody id="itineraryBody">
            </tbody>
        </table>

        <!-- í¬í•¨/ë¶ˆí¬í•¨ ì‚¬í•­ -->
        <div class="include-box">
            <div class="col-2">
                <div>
                    <h3>âœ“ í¬í•¨ ì‚¬í•­</h3>
                    <div id="includedItems" style="white-space: pre-line; line-height: 1.6;"></div>
                </div>
                <div>
                    <h3>âœ— ë¶ˆí¬í•¨ ì‚¬í•­</h3>
                    <div id="excludedItems" style="white-space: pre-line; line-height: 1.6;"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-text">
                ìœ„ì™€ ê°™ì´ ì—¬í–‰ ì¼ì •ì„ ì œì¶œí•©ë‹ˆë‹¤.
            </div>
            <div class="footer-text">
                <span id="printDate"></span>
            </div>
            <div class="footer-company">
                (ìœ ) ì—¬ í–‰ ì„¸ ìƒ  ëŒ€ í‘œ ì´ ì‚¬
            </div>
            <div class="footer-address">
                A: ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ì„œì‹ ë™ 856-1ë²ˆì§€ | T: 063)271-9090 | F: 063)271-9030
            </div>
        </div>
    </div>

    <script>
        // URLì—ì„œ íŒ¨í‚¤ì§€ ID ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const packageId = urlParams.get('id');

        if (packageId) {
            loadAndDisplay(packageId);
        } else {
            alert('íŒ¨í‚¤ì§€ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            window.close();
        }

        function loadAndDisplay(id) {
            const stored = localStorage.getItem('hanatour_packages');
            if (!stored) {
                alert('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const packages = JSON.parse(stored);
            const pkg = packages.find(p => p.id === id);

            if (!pkg) {
                alert('íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            displayPackage(pkg);
        }

        function displayPackage(pkg) {
            // ê¸°ë³¸ ì •ë³´
            document.getElementById('packageName').textContent = pkg.basicInfo.packageName || '';

            // ì¼ì
            if (pkg.departureDates && pkg.departureDates.length > 0) {
                const dates = pkg.departureDates.map(d => d.date).filter(d => d);
                if (dates.length > 0) {
                    const firstDate = dates[0];
                    const lastDate = dates[dates.length - 1];
                    document.getElementById('travelDates').textContent =
                        `${formatDate(firstDate)} ~ ${formatDate(lastDate)} (${pkg.basicInfo.duration || ''})`;
                } else {
                    document.getElementById('travelDates').textContent = pkg.basicInfo.duration || '';
                }
            } else {
                document.getElementById('travelDates').textContent = pkg.basicInfo.duration || '';
            }

            document.getElementById('destination').textContent = pkg.basicInfo.destination || '';
            document.getElementById('airline').textContent = pkg.basicInfo.airline || '';

            // í•­ê³µí¸ ì •ë³´
            if (pkg.itinerary && pkg.itinerary.length > 0) {
                const firstDay = pkg.itinerary[0];
                const lastDay = pkg.itinerary[pkg.itinerary.length - 1];
                let flightInfo = '';

                if (firstDay.transport && firstDay.time) {
                    flightInfo += `${firstDay.region || ''} ${firstDay.transport} (${firstDay.time})`;
                }
                if (lastDay.transport && lastDay.transport !== firstDay.transport) {
                    flightInfo += ` / ${lastDay.region || ''} ${lastDay.transport}`;
                    if (lastDay.time) flightInfo += ` (${lastDay.time})`;
                }
                document.getElementById('flightInfo').textContent = flightInfo;
            }

            // ê°€ê²©
            const price = parseInt(pkg.pricing.priceAdult) || 0;
            document.getElementById('price').textContent = price.toLocaleString() + 'ì›';

            // ì¼ì •í‘œ
            const tbody = document.getElementById('itineraryBody');
            tbody.innerHTML = pkg.itinerary.map(item => `
                <tr>
                    <td class="day-col">DAY ${item.day}</td>
                    <td class="date-col">${item.date ? formatDate(item.date) : '-'}</td>
                    <td class="region-col">${item.region || '-'}</td>
                    <td class="transport-col">${item.transport || '-'}</td>
                    <td class="time-col">${item.time || '-'}</td>
                    <td class="schedule-col">${item.schedule || '-'}</td>
                    <td class="meals-col">${item.meals || '-'}</td>
                    <td class="hotel-col">${item.accommodation || '-'}</td>
                </tr>
            `).join('');

            // í¬í•¨/ë¶ˆí¬í•¨
            document.getElementById('includedItems').textContent = pkg.included || 'ì¼ì •ì— ëª…ì‹œëœ ë‚´ìš©';
            document.getElementById('excludedItems').textContent = pkg.excluded || 'ê°œì¸ ê²½ë¹„';

            // ë‚ ì§œ
            const today = new Date();
            document.getElementById('printDate').textContent =
                `${today.getFullYear()}ë…„ ${String(today.getMonth() + 1).padStart(2, '0')}ì›” ${String(today.getDate()).padStart(2, '0')}ì¼`;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekday = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
            return `${month}ì›” ${day}ì¼(${weekday})`;
        }

        function saveAsHTML() {
            const content = document.getElementById('printContent').outerHTML;
            const fullHTML = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì—¬í–‰ ì¼ì •í‘œ</title>
    <style>
        ${document.querySelector('style').innerHTML}
    </style>
</head>
<body>
    ${content}
</body>
</html>`;

            const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;

            const packageName = document.getElementById('packageName').textContent;
            const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
            a.download = `ì—¬í–‰ì¼ì •í‘œ_${packageName}_${today}.html`;

            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
