<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—¬í–‰ ê²¬ì ì„œ ì¶œë ¥</title>
    <style>
        @media print {
            @page {
                size: A4;
                margin: 10mm;
            }
            .no-print {
                display: none;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .print-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #333;
            padding-bottom: 20px;
        }

        .header h1 {
            font-size: 28pt;
            margin-bottom: 10px;
            color: #333;
        }

        .company-info {
            text-align: right;
            font-size: 10pt;
            color: #666;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 11pt;
        }

        table.info-table th {
            background: #f3ebe1;
            padding: 12px;
            border: 1px solid #bbb;
            text-align: left;
            width: 25%;
            font-weight: bold;
        }

        table.info-table td {
            padding: 12px;
            border: 1px solid #bbb;
        }

        table.condition-table th {
            background: #f3ebe1;
            padding: 10px;
            border: 1px solid #bbb;
            width: 20%;
            font-weight: bold;
        }

        table.condition-table td {
            padding: 10px;
            border: 1px solid #bbb;
        }

        .section-title {
            background: #333;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 13pt;
            font-weight: bold;
            margin-top: 20px;
        }

        .itinerary-day {
            background: #e8f4f8;
            padding: 12px;
            margin: 15px 0;
            border-left: 5px solid #5b9bd5;
        }

        .itinerary-day h3 {
            color: #2e75b6;
            margin-bottom: 10px;
            font-size: 13pt;
        }

        .itinerary-meta {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 10px;
            font-size: 10pt;
        }

        .itinerary-meta div {
            background: white;
            padding: 8px;
            border-radius: 5px;
        }

        .itinerary-meta div strong {
            color: #2e75b6;
            display: block;
            margin-bottom: 3px;
            font-size: 9pt;
        }

        .itinerary-content {
            background: white;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-line;
            line-height: 1.6;
        }

        .footer {
            margin-top: 40px;
            text-align: center;
            padding-top: 20px;
            border-top: 2px solid #333;
        }

        .footer-text {
            font-size: 11pt;
            margin-bottom: 20px;
        }

        .footer-company {
            font-size: 14pt;
            font-weight: bold;
            margin-top: 15px;
        }

        .buttons {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        .btn {
            padding: 12px 30px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            font-size: 14pt;
            cursor: pointer;
            font-family: 'Malgun Gothic', sans-serif;
        }

        .btn-print {
            background: #4CAF50;
            color: white;
        }

        .btn-print:hover {
            background: #45a049;
        }

        .btn-back {
            background: #666;
            color: white;
        }

        .btn-back:hover {
            background: #555;
        }

        .price-highlight {
            color: #c00;
            font-weight: bold;
            font-size: 12pt;
        }

        .note-box {
            background: #fff9e6;
            border: 2px solid #ffd700;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .note-box ul {
            margin-left: 20px;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="buttons no-print">
        <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
        <button class="btn btn-back" onclick="window.close()">â† ëŒì•„ê°€ê¸°</button>
    </div>

    <div class="print-container">
        <div class="company-info">
            ë‹´ë‹¹ì: <span id="printManager"></span> | ì—°ë½ì²˜: <span id="printContact"></span>
        </div>

        <div class="header">
            <h1>ì—¬í–‰ ê²¬ì ì„œ</h1>
        </div>

        <!-- ê¸°ë³¸ ì •ë³´ -->
        <table class="info-table">
            <tr>
                <th>ë‹¨ì²´ëª…</th>
                <td colspan="3" id="printPackageName"></td>
            </tr>
            <tr>
                <th>ì¼ì</th>
                <td colspan="3" id="printDates"></td>
            </tr>
            <tr>
                <th>ì—¬í–‰ì§€</th>
                <td colspan="3" id="printDestination"></td>
            </tr>
            <tr>
                <th>1ì¸ ì—¬í–‰ìš”ê¸ˆ</th>
                <td id="printAirline"></td>
                <td id="printFlightInfo"></td>
                <td class="price-highlight" id="printPrice"></td>
            </tr>
        </table>

        <!-- ì—¬í–‰ ì¡°ê±´ -->
        <div class="section-title">â™ ì—¬ í–‰ ì¡° ê±´ â™</div>
        <table class="condition-table">
            <tr>
                <th>í•­ê³µë£Œ</th>
                <td colspan="2">ì „ ì¼ì •ì— ëª…ì‹œëœ í•­ê³µë£Œ</td>
            </tr>
            <tr>
                <th>ìˆ™ë°•</th>
                <td colspan="2">ì¼ì •ì— ìˆëŠ” ìˆ™ë°• í¬í•¨ (2ì¸ 1ì‹¤ ê¸°ì¤€)</td>
            </tr>
            <tr>
                <th>ì‹ì‚¬</th>
                <td colspan="2">ì¼ì •ì— ìˆëŠ” ì‹ì‚¬ í¬í•¨</td>
            </tr>
            <tr>
                <th>êµí†µí¸</th>
                <td colspan="2" id="printTransport"></td>
            </tr>
            <tr>
                <th>ê´€ê´‘</th>
                <td colspan="2">ì „ ì¼ì •ì— ëª…ì‹œëœ ê´€ê´‘ ë¹„ìš© í¬í•¨</td>
            </tr>
            <tr>
                <th>ì—¬í–‰ì ë³´í—˜</th>
                <td colspan="2">ì—¬í–‰ ê¸°ê°„ í•´ì™¸ ì—¬í–‰ì ë³´í—˜ ê°€ì…</td>
            </tr>
            <tr>
                <th>ê¸°íƒ€ ì„¸ê¸ˆ</th>
                <td colspan="2">ê³µí•­ ì´ìš©ë£Œ, ì¶œêµ­ì„¸, ì…êµ­ì„¸ í¬í•¨</td>
            </tr>
            <tr>
                <th>ë¹„ê³  ì‚¬í•­</th>
                <td colspan="2" id="printNotes"></td>
            </tr>
        </table>

        <!-- ì¼ì • -->
        <div class="section-title">â™ ì—¬ í–‰ ì¼ ì • â™</div>
        <div id="printItinerary"></div>

        <!-- í¬í•¨/ë¶ˆí¬í•¨ ì‚¬í•­ -->
        <div class="section-title">â™ í¬í•¨/ë¶ˆí¬í•¨ ì‚¬í•­ â™</div>
        <table class="condition-table">
            <tr>
                <th>í¬í•¨ì‚¬í•­</th>
                <td style="white-space: pre-line;" id="printIncluded"></td>
            </tr>
            <tr>
                <th>ë¶ˆí¬í•¨ì‚¬í•­</th>
                <td style="white-space: pre-line;" id="printExcluded"></td>
            </tr>
        </table>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-text">
                ìœ„ì™€ ê°™ì´ ì—¬í–‰ ê²½ë¹„ ê²¬ì ì„œë¥¼ ì œì¶œí•©ë‹ˆë‹¤.
            </div>
            <div class="footer-text">
                <span id="printDate"></span>
            </div>
            <div class="footer-company">
                (ìœ ) ì—¬ í–‰ ì„¸ ìƒ  ëŒ€ í‘œ ì´ ì‚¬
            </div>
            <div style="margin-top: 20px; font-size: 9pt; color: #666;">
                A: ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ì„œì‹ ë™ 856-1ë²ˆì§€ | T: 063)271-9090 | F: 063)271-9030
            </div>
        </div>
    </div>

    <script>
        // URLì—ì„œ íŒ¨í‚¤ì§€ ID ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const packageId = urlParams.get('id');

        if (packageId) {
            loadPackageData(packageId);
        } else {
            alert('íŒ¨í‚¤ì§€ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            window.close();
        }

        function loadPackageData(id) {
            const stored = localStorage.getItem('hanatour_packages');
            if (!stored) {
                alert('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const packages = JSON.parse(stored);
            const pkg = packages.find(p => p.id === id);

            if (!pkg) {
                alert('íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë°ì´í„° ì±„ìš°ê¸°
            fillPrintData(pkg);
        }

        function fillPrintData(pkg) {
            // ê¸°ë³¸ ì •ë³´
            document.getElementById('printManager').textContent = 'ê¹€êµ­ì§„';
            document.getElementById('printContact').textContent = '010-2662-9009';
            document.getElementById('printPackageName').textContent = pkg.basicInfo.packageName || '';

            // ì¶œë°œì¼ ì •ë³´
            if (pkg.departureDates && pkg.departureDates.length > 0) {
                const firstDate = pkg.departureDates[0].date;
                const lastDate = pkg.departureDates[pkg.departureDates.length - 1].date;
                document.getElementById('printDates').textContent = `${firstDate} ~ ${lastDate}`;
            } else {
                document.getElementById('printDates').textContent = pkg.basicInfo.duration || '';
            }

            document.getElementById('printDestination').textContent = pkg.basicInfo.destination || '';
            document.getElementById('printAirline').textContent = pkg.basicInfo.airline || '';

            // í•­ê³µí¸ ì •ë³´ (ì¼ì •ì—ì„œ ì¶”ì¶œ)
            if (pkg.itinerary && pkg.itinerary.length > 0) {
                const firstDay = pkg.itinerary[0];
                const lastDay = pkg.itinerary[pkg.itinerary.length - 1];
                let flightInfo = '';
                if (firstDay.transport) flightInfo += firstDay.transport;
                if (firstDay.time) flightInfo += ` (${firstDay.time})`;
                if (lastDay.transport && lastDay.transport !== firstDay.transport) {
                    flightInfo += '<br>' + lastDay.transport;
                    if (lastDay.time) flightInfo += ` (${lastDay.time})`;
                }
                document.getElementById('printFlightInfo').innerHTML = flightInfo;
            }

            // ê°€ê²©
            const price = parseInt(pkg.pricing.priceAdult) || 0;
            document.getElementById('printPrice').textContent = price.toLocaleString() + 'ì›';

            // êµí†µí¸
            document.getElementById('printTransport').textContent = 'ì¼ì •ì— ë”°ë¥¸ ì°¨ëŸ‰ ì´ìš© êµí†µ í¬í•¨';

            // ë¹„ê³ ì‚¬í•­
            let notes = [];
            notes.push('â—‹ ìƒê¸° ì¼ì •ì€ ê¸°ìƒì•…í™”ë‚˜ í˜„ì§€ ì‚¬ì •ìœ¼ë¡œ ì¸í•˜ì—¬ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            notes.push('â—‹ í˜„ê¸ˆ ê²°ì œ ì¡°ê±´ì…ë‹ˆë‹¤.');
            notes.push('â—‹ ì‹ì‚¬ ì‹œ ìŒë£Œ(ì£¼ë¥˜) ë° ì‹ì‚¬ ì¶”ê°€ëŠ” ë¶ˆí¬í•¨');
            if (pkg.notes) {
                notes.push('â—‹ ' + pkg.notes.replace(/\n/g, '\nâ—‹ '));
            }
            document.getElementById('printNotes').innerHTML = notes.join('<br>');

            // ì¼ì •
            const itineraryHTML = pkg.itinerary.map(item => `
                <div class="itinerary-day">
                    <h3>DAY ${item.day}${item.date ? ` (${item.date})` : ''}</h3>
                    <div class="itinerary-meta">
                        ${item.region ? `<div><strong>ì§€ì—­</strong>${item.region}</div>` : ''}
                        ${item.transport ? `<div><strong>êµí†µí¸</strong>${item.transport}</div>` : ''}
                        ${item.time ? `<div><strong>ì‹œê°„</strong>${item.time}</div>` : ''}
                        ${item.meals ? `<div><strong>ì‹ì‚¬</strong>${item.meals}</div>` : ''}
                    </div>
                    ${item.schedule ? `
                        <div class="itinerary-content">${item.schedule}</div>
                    ` : ''}
                    ${item.accommodation ? `
                        <div style="margin-top: 10px; font-weight: bold;">ğŸ¨ ìˆ™ë°•: ${item.accommodation}</div>
                    ` : ''}
                </div>
            `).join('');
            document.getElementById('printItinerary').innerHTML = itineraryHTML;

            // í¬í•¨/ë¶ˆí¬í•¨
            document.getElementById('printIncluded').textContent = pkg.included || 'ì¼ì •ì— ëª…ì‹œëœ ë‚´ìš©';
            document.getElementById('printExcluded').textContent = pkg.excluded || 'ê°œì¸ ê²½ë¹„';

            // ë‚ ì§œ
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('printDate').textContent = `${year}ë…„ ${month}ì›” ${day}ì¼`;
        }
    </script>
</body>
</html>
